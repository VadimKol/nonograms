(()=>{"use strict";const e=["easy","norm","hard"],t=[5,10,15];function n(e,t){return Math.trunc(Math.random()*(t-e+1))+e}function l(e,t,n){let l;e.forEach((e=>(e.innerText="",e))),t.forEach((e=>(e.innerText="",e))),l=5===n.rowclue.length?3:10===n.rowclue.length?5:8;for(let t=0,c=0;t<n.rowclue.length;t+=1){c+=l-n.rowclue[t].length;for(let l=0;l<n.rowclue[t].length;l+=1,c+=1)e[c].append(n.rowclue[t][l])}const c=[];for(let e=0;e<t.length;e+=1)for(let s=0;s<l;s+=1)c.push(t[n.columnclue.length*s+e]);for(let e=0,t=0;e<n.columnclue.length;e+=1){t+=l-n.columnclue[e].length;for(let l=0;l<n.columnclue[e].length;l+=1,t+=1)c[t].append(n.columnclue[e][l])}}function c(){document.querySelector(".templates").classList.toggle("templates_show")}function s(){document.querySelector(".difficulty").classList.toggle("difficulty_show")}function o(e,t){for(let n=0,l=0;n<e.length;n+=1)e[n].difficulty===t&&(document.querySelectorAll(".templates__item")[l].innerText=e[n].name,l+=1)}function i(e){document.querySelector(".name").innerText=e}const d=document.createElement("div");d.classList.add("wrapper");const a=document.createElement("h1");a.classList.add("title"),a.append("Nonograms");const r=document.createElement("p");r.classList.add("name"),document.body.append(d);const m=document.createElement("div");m.classList.add("field");const u=document.createElement("div");u.classList.add("rowclue");const _=document.createElement("div");_.classList.add("columnclue");const f=document.createElement("div");f.classList.add("vdivider");const p=document.createElement("div");p.classList.add("hdivider");const L=document.createElement("button");L.classList.add("reset-btn"),L.classList.add("btn"),L.type="button",L.append("Reset");const g=document.createElement("button");g.classList.add("templates-btn"),g.classList.add("btn"),g.type="button",g.append("Templates"),g.addEventListener("click",c);const y=document.createElement("ul");y.classList.add("templates"),y.classList.add("list");for(let e=0;e<5;e+=1){const t=document.createElement("li");t.classList.add("templates__item"),t.classList.add(`templates__item-${e+1}`),y.append(t)}const b=document.createElement("p");b.classList.add("timer");const v=document.createElement("span");v.classList.add("timer__minutes"),v.append("00");const h=document.createElement("span");h.classList.add("timer__seconds"),h.append("00"),b.append(v),b.append(":"),b.append(h);const E=document.createElement("button");E.classList.add("save-btn"),E.classList.add("btn"),E.type="button",E.append("Save");const S=document.createElement("button");S.classList.add("load-btn"),S.classList.add("btn"),S.type="button",S.append("Load");const k=document.createElement("button");k.classList.add("theme-btn"),k.type="button",k.addEventListener("click",(function(){document.body.classList.toggle("body-dark-theme")}));const w=document.createElement("div");w.classList.add("score");const q=document.createElement("p");q.classList.add("score__title"),q.append("Latest 5 wins:");const N=document.createElement("ol");N.classList.add("score__list");for(let e=0;e<5;e+=1){const e=document.createElement("li");e.classList.add("score__item"),N.append(e)}w.append(q),w.append(N);const x=document.createElement("button");x.classList.add("difficulty-btn"),x.classList.add("btn"),x.type="button",x.append("Difficulty"),x.addEventListener("click",s);const T=document.createElement("ul");T.classList.add("difficulty"),T.classList.add("list");for(let t=0;t<3;t+=1){const n=document.createElement("li");n.classList.add("difficulty__item"),n.append(e[t]),T.append(n)}const A=document.createElement("button");A.classList.add("random-btn"),A.classList.add("btn"),A.type="button",A.append("Random");const I=document.createElement("button");I.classList.add("solution-btn"),I.classList.add("btn"),I.type="button",I.append("Solution");const O=document.createElement("button");O.classList.add("sound-btn"),O.type="button",m.append(u),m.append(_),m.append(f),m.append(p),m.append(a),m.append(r),m.append(L),m.append(A),m.append(I),m.append(O),m.append(g),m.append(y),m.append(b),m.append(E),m.append(S),m.append(k),m.append(w),m.append(x),m.append(T),d.append(m);const R=document.querySelector(".field"),$=document.querySelector(".templates"),C=document.querySelector(".reset-btn"),D=document.querySelector(".random-btn"),K=document.querySelector(".solution-btn"),V=document.querySelector(".sound-btn"),J=document.querySelector(".save-btn"),j=document.querySelector(".load-btn");let M,G,P,Y,z,B=0,F=0,H=0,Q=.5;const U=document.querySelector(".timer__minutes"),W=document.querySelector(".timer__seconds");let X=document.querySelectorAll(".rowclue__item"),Z=document.querySelectorAll(".columnclue__item");const ee=new Audio("black.wav"),te=new Audio("cross.wav"),ne=new Audio("white.wav"),le=new Audio("win.wav");let ce={},se=[];const oe=document.querySelectorAll(".score__item"),ie=document.querySelector(".difficulty");function de(){const n=t[e.indexOf(Y)];if(document.querySelectorAll(".field__item").forEach((e=>e.remove())),document.querySelectorAll(".field-divider").forEach((e=>e.remove())),2===R.classList.length&&R.classList.remove(R.classList[1]),5===n)for(let e=0;e<n*n;e+=1){const e=document.createElement("div");e.classList.add("field__item"),e.classList.add("field__item_easy"),R.prepend(e)}if(10===n)for(let e=0,t=5;e<(n+1)*(n+1);e+=1){const l=document.createElement("div");e!==t?e>=55&&e<=65?l.classList.add("field-divider"):(l.classList.add("field__item"),l.classList.add("field__item_norm")):(l.classList.add("field-divider"),t+=n+1),R.prepend(l)}if(15===n)for(let e=0,t=5,l=11;e<(n+2)*(n+2);e+=1){const c=document.createElement("div");e!==t&&e!==l?e>=85&&e<=101||e>=187&&e<=203?c.classList.add("field-divider"):(c.classList.add("field__item"),c.classList.add("field__item_hard")):(c.classList.add("field-divider"),e===t?t+=n+2:l+=n+2),R.prepend(c)}R.classList.toggle(`field_${Y}`)}function ae(){const n=t[e.indexOf(Y)],l=document.querySelector(".rowclue"),c=document.querySelector(".columnclue");if(l.replaceChildren(),c.replaceChildren(),2===l.classList.length&&l.classList.remove(l.classList[1]),2===c.classList.length&&c.classList.remove(c.classList[1]),5===n){for(let e=0;e<3*n;e+=1){const e=document.createElement("div");e.classList.add("rowclue__item"),e.classList.add("rowclue__item_easy"),l.append(e)}for(let e=0;e<3*n;e+=1){const e=document.createElement("div");e.classList.add("columnclue__item"),e.classList.add("columnclue__item_easy"),c.append(e)}}if(10===n){for(let e=0;e<5*n+5;e+=1){const t=document.createElement("div");e>=25&&e<=29||(t.classList.add("rowclue__item"),t.classList.add("rowclue__item_norm")),l.append(t)}for(let e=0,t=5;e<5*n+5;e+=1){const l=document.createElement("div");e!==t?(l.classList.add("columnclue__item"),l.classList.add("columnclue__item_norm")):t+=n+1,c.append(l)}}if(15===n){for(let e=0,t=3;e<8*n+15+18;e+=1){const n=document.createElement("div");e!==t?e>=45&&e<=53||e>=99&&e<=107||(n.classList.add("rowclue__item"),n.classList.add("rowclue__item_hard")):t+=9,l.append(n)}for(let e=0,t=5,l=11;e<8*n+15+18;e+=1){const s=document.createElement("div");e!==t&&e!==l?e>=51&&e<=67||(s.classList.add("columnclue__item"),s.classList.add("columnclue__item_hard")):e===t?t+=n+2:l+=n+2,c.append(s)}}l.classList.toggle(`rowclue_${Y}`),c.classList.toggle(`columnclue_${Y}`),X=document.querySelectorAll(".rowclue__item"),Z=document.querySelectorAll(".columnclue__item")}function re(){H=setInterval((()=>{59===F?(B+=1,F=0):F+=1,W.innerText=F<10?"0".concat(String(F)):String(F),U.innerText=B<10?"0".concat(String(B)):String(B)}),1e3)}function me(){clearInterval(H),H=0,B=0,F=0,U.innerText="00",W.innerText="00"}function ue(e){let t=P,l=1;for(;l>0&&(t=n(0,M.length-1),e!==M[t].difficulty||P===t);)l+=1;P=t,G=M[P],z=G.name}function _e(){for(;null!==document.querySelector(".field__item_clicked");)document.querySelector(".field__item_clicked").classList.toggle("field__item_clicked");for(;null!==document.querySelector(".field__item_r-clicked");)document.querySelector(".field__item_r-clicked").classList.toggle("field__item_r-clicked");for(;null!==document.querySelector(".field__item_s-clicked");)document.querySelector(".field__item_s-clicked").classList.toggle("field__item_s-clicked");me()}function fe(){document.querySelector(".modal-back").remove(),function(){se.push({name:G.name,date:Date.now(),level:Y,timer:U.innerText.concat(":",W.innerText)}),6===se.length&&(se.sort(((e,t)=>t.date-e.date)),se.pop()),se.sort(((e,t)=>{const[n,l]=e.timer.split(":"),[c,s]=t.timer.split(":");return Number(n)>Number(c)||Number(n)===Number(c)&&Number(l)>Number(s)?1:Number(n)<Number(c)||Number(n)===Number(c)&&Number(l)<Number(s)?-1:0}));for(let e=0;e<se.length;e+=1)oe[e].innerText=`${se[e].name} ${se[e].level} ${se[e].timer}`;localStorage.setItem("nonogramScoreVK",JSON.stringify(se))}(),_e(),ue(Y),i(z),l(X,Z,G),console.log("Current Nonogram is: "),G.riddle.forEach((e=>console.log(...e))),console.log(G.name),ie.classList.contains("difficulty_show")&&s(),$.classList.contains("templates_show")&&c(),document.body.classList.toggle("overflow-body")}function pe(){const n=document.querySelectorAll(".field__item");let l=!1;const c=t[e.indexOf(Y)];for(let e=0,t=0;e<n.length&&(e>=c&&e%c==0&&(t+=1),!(n[e].classList.contains("field__item_clicked")&&0===G.riddle[t][e%c]||!n[e].classList.contains("field__item_clicked")&&1===G.riddle[t][e%c]));e+=1)e===n.length-1&&(l=!0);l&&(le.volume=Q,setTimeout((()=>{le.play()}),250),document.body.classList.toggle("overflow-body"),function(){clearInterval(H);const e=document.createElement("div");e.classList.add("modal-back");const t=document.createElement("div");t.classList.add("modal");const n=document.createElement("p");n.classList.add("modal__msg"),n.append("Great! You have solved the nonogram in "),n.append(U.innerText),n.append(":"),n.append(W.innerText),n.append(" !"),t.append(n);const l=document.createElement("button");l.classList.add("modal__new-btn"),l.classList.add("btn"),l.type="button",l.append("Play again"),l.addEventListener("click",fe),t.append(l),e.append(t),document.body.append(e)}())}if((async()=>{try{const e=await fetch("riddles.json");if(!e.ok)throw new Error(e.status);M=await e.json(),Y="easy",ue(Y),de(),ae(),l(X,Z,G),o(M,Y),i(z),console.log("Current Nonogram is: "),G.riddle.forEach((e=>console.log(...e))),console.log(G.name)}catch(e){console.log(e)}})(),null!==localStorage.getItem("nonogramVK")&&j.classList.toggle("load-btn_show"),null!==localStorage.getItem("nonogramScoreVK")){se=JSON.parse(localStorage.getItem("nonogramScoreVK"));for(let e=0;e<se.length;e+=1)oe[e].innerText=`${se[e].name} ${se[e].level} ${se[e].timer}`}C.addEventListener("click",_e),D.addEventListener("click",(function(){let e=P;for(;e===P;)e=n(0,M.length-1);P=e,G=M[P],Y=G.difficulty,z=G.name,console.log("Current Nonogram is: "),G.riddle.forEach((e=>console.log(...e))),console.log(G.name),de(),ae(),l(X,Z,G),o(M,Y),i(z),me(),ie.classList.contains("difficulty_show")&&s(),$.classList.contains("templates_show")&&c()})),K.addEventListener("click",(function(){for(;null!==document.querySelector(".field__item_clicked");)document.querySelector(".field__item_clicked").classList.toggle("field__item_clicked");for(;null!==document.querySelector(".field__item_r-clicked");)document.querySelector(".field__item_r-clicked").classList.toggle("field__item_r-clicked");const n=document.querySelectorAll(".field__item"),l=t[e.indexOf(Y)];for(let e=0,t=0;e<n.length;e+=1)e>=l&&e%l==0&&(t+=1),1===G.riddle[t][e%l]&&n[e].classList.toggle("field__item_s-clicked")})),R.onclick=e=>{const t=e.target;t.classList.contains("field__item")&&function(e){if(e.classList.contains("field__item_r-clicked")||!e.classList.contains("field__item_clicked")){const e=ee.cloneNode(!1);e.volume=Q,e.play()}else{const e=ne.cloneNode(!1);e.volume=Q,e.play()}0===H&&re(),e.classList.contains("field__item_r-clicked")&&e.classList.toggle("field__item_r-clicked"),e.classList.contains("field__item_s-clicked")&&e.classList.toggle("field__item_s-clicked"),e.classList.toggle("field__item_clicked"),pe()}(t)},R.addEventListener("contextmenu",(e=>{if("mouse"===e.pointerType){const t=e.target;if((e.target.classList.contains("field")||e.target.classList.contains("field-divider"))&&e.preventDefault(),!t.classList.contains("field__item"))return;e.preventDefault(),function(e){if(e.classList.contains("field__item_clicked")||!e.classList.contains("field__item_r-clicked")){const e=te.cloneNode(!1);e.volume=Q,e.play()}else{const e=ne.cloneNode(!1);e.volume=Q,e.play()}0===H&&re(),e.classList.contains("field__item_clicked")&&e.classList.toggle("field__item_clicked"),e.classList.contains("field__item_s-clicked")&&e.classList.toggle("field__item_s-clicked"),e.classList.toggle("field__item_r-clicked"),pe()}(t)}})),$.addEventListener("click",(function(t){const n=t.target;"LI"===n.tagName&&(_e(),P=n.classList[1].replace("templates__item-","")-1+5*e.indexOf(Y),G=M[P],Y=G.difficulty,z=G.name,i(z),l(X,Z,G),console.log("Current Nonogram is: "),G.riddle.forEach((e=>console.log(...e))),console.log(G.name),c())})),J.addEventListener("click",(function(){const n=t[e.indexOf(Y)];ce.timer=U.innerText.concat(":",W.innerText),ce.currentRiddle=G,ce.currentRiddleId=P,ce.currentRiddleDifficulty=Y,ce.currentRiddleName=G.name,ce.field=Array.from({length:n*n},(()=>0));const l=document.querySelectorAll(".field__item");for(let e=0;e<ce.field.length;e+=1)l[e].classList.contains("field__item_clicked")?ce.field[e]=1:l[e].classList.contains("field__item_r-clicked")&&(ce.field[e]=2);localStorage.setItem("nonogramVK",JSON.stringify(ce)),j.classList.contains("load-btn_show")||j.classList.toggle("load-btn_show")})),j.addEventListener("click",(function(){_e(),ce=JSON.parse(localStorage.getItem("nonogramVK")),G=ce.currentRiddle,P=ce.currentRiddleId,Y=ce.currentRiddleDifficulty,z=ce.currentRiddleName,de(),ae();const e=document.querySelectorAll(".field__item");for(let t=0;t<ce.field.length;t+=1)1===ce.field[t]?e[t].classList.toggle("field__item_clicked"):2===ce.field[t]&&e[t].classList.toggle("field__item_r-clicked");i(z),l(X,Z,G),o(M,Y),[U.innerText,W.innerText]=ce.timer.split(":"),B=Number(U.innerText),F=Number(W.innerText),console.log("Current Nonogram is: "),G.riddle.forEach((e=>console.log(...e))),console.log(G.name)})),ie.addEventListener("click",(function(e){const t=e.target;"LI"===t.tagName&&(s(),_e(),Y=t.innerText,ue(Y),de(),ae(),l(X,Z,G),o(M,Y),i(z),console.log("Current Nonogram is: "),G.riddle.forEach((e=>console.log(...e))),console.log(G.name),$.classList.contains("templates_show")&&c())})),V.addEventListener("click",(function(){Q=V.classList.contains("sound-btn-off")?.5:0,V.classList.toggle("sound-btn-off")}))})();